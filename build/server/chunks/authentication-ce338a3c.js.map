{"version":3,"file":"authentication-ce338a3c.js","sources":["../../../.svelte-kit/adapter-node/chunks/authentication.js"],"sourcesContent":["import { d as database } from \"./database.js\";\nimport * as crypto from \"crypto\";\nclass AuthHandler {\n  async register(form, cookies) {\n    const username = form.get(\"username\")?.toString();\n    const password = form.get(\"password\")?.toString();\n    if (username && password) {\n      let users = await database.user.findUnique({ where: { username } });\n      if (password.length < 5) {\n        return { success: false, message: \"Password is too weak!\" };\n      }\n      if (!users) {\n        const session = crypto.randomUUID();\n        const salt = crypto.randomBytes(16).toString(\"hex\");\n        const hash = crypto.pbkdf2Sync(password, salt, 1e3, 64, \"sha512\").toString(\"hex\");\n        await database.user.create({\n          data: { username, hash, salt, session }\n        });\n        return { success: true, message: \"Created a new user!\" };\n      } else if (users) {\n        return { success: false, message: \"User already exists!\" };\n      }\n    }\n    return { success: false, message: \"Account creation failed!\" };\n  }\n  async login(form, cookies) {\n    const username = form.get(\"username\")?.toString();\n    const password = form.get(\"password\")?.toString();\n    if (!username) {\n      return { success: false, message: \"Error getting the username!\" };\n    }\n    if (!password) {\n      return { success: false, message: \"Error getting the password!\" };\n    }\n    try {\n      const result = await database.user.findUnique({\n        where: { username }\n      });\n      if (!result) {\n        return { success: false, message: \"Couldn't find the username!\" };\n      }\n      const { salt, hash } = result;\n      const newhash = crypto.pbkdf2Sync(password, salt, 1e3, 64, \"sha512\").toString(\"hex\");\n      if (newhash != hash) {\n        return { success: false, message: \"Wrong password!\" };\n      }\n      const session = crypto.randomUUID();\n      const update = await database.user.update({\n        where: { id: result.id },\n        data: {\n          session\n        }\n      });\n      if (update)\n        return { success: true, message: \"Logged in!\", session: update.session };\n    } catch (e) {\n      return { success: false, message: \"Couldn't log in!\" };\n    }\n    return { success: false, message: \"Couldn't log in!\" };\n  }\n}\nconst auth = new AuthHandler();\nexport {\n  auth as a\n};\n"],"names":[],"mappings":"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"}